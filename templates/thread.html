<style>

        .suretate{
        margin: 40px; 
        }

        .on {
        display: inline;
  margin-right: 5px;
    
        }
        body.theme-d {
            background:#ffffff;
        } /* Midnight Tokyo Theme */
        body.theme-m {
            background: linear-gradient(180deg, #0d0d1a 0%, #1a1a2e 100%);
            color: #cfd9ff;
            font-family: "MS Gothic", "Share Tech Mono", monospace;
        }
        body.theme-m h1, body.theme-m h2, body.theme-m h3 {
            color: #ff00cc;
            text-shadow: 0 0 6px #ff00cc, 0 0 12px #ff33cc;
        }
        body.theme-m a {
            color: #00eaff;
            text-shadow: 0 0 6px #00eaff, 0 0 12px #00aaff;
            text-decoration: none;
        }
        body.theme-m a:hover {
            color: #fff;
            text-shadow: 0 0 12px #00ffff, 0 0 24px #00ffff;
        }
        body.theme-m button {
            background: #111;
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 5px 10px;
            border-radius: 4px;
            text-shadow: 0 0 6px #00ffff;
            transition: 0.2s;
        }
        body.theme-m button:hover {
            background: #00ffff;
            color: #111;
            box-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff;
        }


        body.theme-2 .b{
            color: #f5f5f5;
            padding: 1rem 2rem;
        }
        body.theme-2{
            background-image: url("{{ url_for('static', filename='ki.png') }}");
            background-repeat: repeat-y;
        }
        body.theme-t{
            background-image: url("{{ url_for('static', filename='th.jpeg') }}");
        }
        body.theme-i{
            background:#b8860b;
        }
        .theme-t h1 {
            color: #ff0000;
        }
  
        body.theme-d button {
            background: #ffffff;
            border: 1px solid #000000;
            color: #000000;
            padding: 5px 10px;
            border-radius: 4px;
            transition: 0.2s;
        }
        body.theme-d button:hover {
            background: #000000;
            color: #ffffff;
        }
 
        body.theme-i button {
            background: #4b0082;
            border: 1px solid #ffffff;
            color: #ffffff;
            padding: 5px 10px;
            border-radius: 7px;
            transition: 0.2s;
        }
        body.theme-i button:hover {
            background: #ffffff;
            color: #4b0082;
        }
        body.theme-t button {
            background: #e0ebaf;
            border: 1px solid #d7003a;
            color: #d7003a;
            padding: 5px 10px;
            border-radius: 10px;
            transition: 0.2s;
        }
        body.theme-t button:hover {
            background: #d7003a;
            color: #e0ebaf;
        }
 
    </style>
<body>
<a href="/">← スレッド一覧に戻る</a>
<h1>{{ thread[1] }}</h1>
<p>現在の接続人数: <span id="onlineCount">0</span> 人</p>

<ul id="posts"></ul>

<form method="post">
  名前: <input type="text" name="name"><br>
  本文: <textarea name="message"></textarea><br>
  <button type="submit">投稿</button>
</form>
</body>
<script>
const threadId = {{ thread_id }};
let lastPostId = 0;

function fetchPosts() {
  fetch(`/thread/${threadId}/posts_json?after=${lastPostId}`)
    .then(response => response.json())
    .then(data => {
      const postsUl = document.getElementById("posts");
      data.posts.forEach(post => {
        // 既に表示済みかどうかチェック
        if (!document.getElementById(`post-${post.id}`)) {
          const li = document.createElement("li");
          li.id = `post-${post.id}`;
          li.textContent = `${post.name}: ${post.message}`;
          postsUl.appendChild(li);
        }
      });
      // 最後の投稿IDを更新
      if (data.posts.length > 0) {
        lastPostId = data.posts[data.posts.length - 1].id;
      }
    })
    .catch(err => console.error(err));
}

// 初回取得
fetchPosts();
// 5秒ごとに取得
setInterval(fetchPosts, 5000);
</script>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const socket = io();
socket.emit("join_thread", { thread_id: threadId });

socket.on("online_count", function(count) {
  document.getElementById("onlineCount").textContent = count;
});

window.addEventListener("beforeunload", () => {
  socket.emit("leave_thread", { thread_id: threadId });
});
</script>
