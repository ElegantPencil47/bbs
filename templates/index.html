<!DOCTYPE html>
<html lang="ja">
<head>
<link rel="icon" href="/static/favicon.ico">
    <meta charset="UTF-8">
    <title>Lunar Eclipse</title>
    <style>
        a {
        text-decoration: none;
        color: black;
margin: 20px;
}



h2{
margin: 30px;

}

.tuki{
border: 10px ridge #008000;
background-color: black;
color: white;
 max-width: 100px;
margin: 30px;
}


a.btn--orange {
  color: black;
padding: 12px;
  background-color: white;
  border-bottom: 5px solid #696969;
}
a.btn--orange:hover {
  margin-top: 3px;
  color: black;
  background: white;
  border-bottom: 2px solid #696969;
}
a.btn--shadow {
  -webkit-box-shadow: 0 3px 5px rgba(0, 0, 0, .3);
  box-shadow: 0 3px 5px rgba(0, 0, 0, .3);
}
.suretai {
  color: #505050;/*文字色*/
  padding: 0.5em;/*文字周りの余白*/
  display: inline-block;/*おまじない*/
margin: 10px; 
  line-height: 1.3;/*行高*/

  vertical-align: middle;
  border-radius: 25px 0px 0px 25px;/*左側の角を丸く*/
}

.suretai:before {
  content: '●';
  color: #ffc0cb;
  margin-right: 8px;
}
        .suretate{
        margin: 40px; 
        }
        .stsure{
        margin: 40px; 
        }

body{
background-color: #fffacd;
}

        .on {
        display: inline;
  margin-right: 5px;
font-weight: bold;
text-align: center !important;
    
        }



.go{
border-bottom: 5px solid #c0c0c0;
border-left: 3px solid #c0c0c0;
}



button{
  position: relative;
  display: inline-block;
background: white;
  transition: .3s;
}
button: hover{
background: #d3d3d3;
}
button::after {
  position: absolute;
  bottom: 0;
  left: 50%;
  content: '';
  width: 0;
  height: 2px;
  background-color: #31aae2;
  transition: .3s;
  transform: translateX(-50%);
}

button:hover::after{
  width: 100%;
}


#threads {
  list-style-type: none;
  padding-left: 0;
}

.stsure{
border: 10px outset #ff1493;
background-color: #ffc0cb;
}
.suretate{
background-color: #98fb98;
 border: solid 3px #228b22;
border-radius: 0.5em;

}

.yaju{
      justify-content: space-between;
display: flex;
 background-color: #000000;
padding:10px 20px;
    }
.mur{
color: #ffffff;
margin: 20px;
}

 
    </style>
</head>

<img src="/static/eclipse.png" width="400" class = "go"><br>
<a href="{{ url_for('aa') }}" style="font-size:20px;" class="btn btn--orange btn--cubic btn--shadow"><img src="https://tshop.r10s.jp/msproject/cabinet/jdm/imgrc0092897601.jpg?fitin=720%3A720" width="40">AA・コピペ保管庫  ></a>




<h2>「天文学」から「民俗学」までの学問を手広くカバーする匿名掲示板</h2>

<div class="tuki">
<h3>今日の月齢</h3>
<div id="moon-age-result">計算中...</div>
    <div id="moon-phase-message"></div> <!-- ここに条件に応じたメッセージを表示 -->
    <img src="" width="50" id="target">
  

    <script>
        // 月齢を計算する関数 (変更なし)
        function calculateMoonAge(date = new Date()) {
            const knownNewMoon = new Date('1970-01-07T20:35:00Z');
            const lunarCycle = 29.530588853;
            const daysSinceKnownNewMoon = (date.getTime() - knownNewMoon.getTime()) / (1000 * 60 * 60 * 24);
            let moonAge = daysSinceKnownNewMoon % lunarCycle;
            if (moonAge < 0) {
                moonAge += lunarCycle;
            }
            return moonAge; // toFixed(2)を外し、数値（小数点付き）として返すように変更
        }

        // 結果をウェブサイトに表示し、条件分岐を行う関数
        function displayMoonAge() {
            const currentMoonAgeValue = calculateMoonAge(); // 数値として取得
            const currentMoonAgeFormatted = currentMoonAgeValue.toFixed(2); // 表示用に整形
            let target = document.querySelector("#target");
            
            document.getElementById('moon-age-result').textContent = `${currentMoonAgeFormatted} 日`;

            // *** ここからがご質問の条件分岐です ***
            const messageArea = document.getElementById('moon-phase-message');

            if (currentMoonAgeValue > 0 && currentMoonAgeValue < 1) {
                messageArea.textContent = "新月";
                target.src = "{{ url_for('static', filename='1.png') }}";
            } else if (currentMoonAgeValue > 1 && currentMoonAgeValue < 2) {
                messageArea.textContent = "二日月";
                target.src = "{{ url_for('static', filename='2.png') }}";
            } else if (currentMoonAgeValue > 2 && currentMoonAgeValue < 3) {
                messageArea.textContent = "三日月";
                target.src = "{{ url_for('static', filename='3.png') }}";
            } else if (currentMoonAgeValue > 3 && currentMoonAgeValue < 4) {
                messageArea.textContent = "四日月";
                target.src = "{{ url_for('static', filename='4.png') }}";
            } else if (currentMoonAgeValue > 4 && currentMoonAgeValue < 5) {
                messageArea.textContent = "五日月";
                target.src = "{{ url_for('static', filename='5.png') }}";
            } else if (currentMoonAgeValue > 5 && currentMoonAgeValue < 6) {
                messageArea.textContent = "六日月";
                target.src = "{{ url_for('static', filename='6.png') }}";
            } else if (currentMoonAgeValue > 6 && currentMoonAgeValue < 7) {
                messageArea.textContent = "上限の月";
                target.src = "{{ url_for('static', filename='7.png') }}";
            } else if (currentMoonAgeValue > 7 && currentMoonAgeValue < 8) {
                messageArea.textContent = "八日月";
                target.src = "{{ url_for('static', filename='8.png') }}";
            } else if (currentMoonAgeValue > 8 && currentMoonAgeValue < 9) {
                messageArea.textContent = "九日月";
                target.src = "{{ url_for('static', filename='9.png') }}";
            } else if (currentMoonAgeValue > 9 && currentMoonAgeValue < 10) {
                messageArea.textContent = "十日夜の月";
                target.src = "{{ url_for('static', filename='10.png') }}";
            } else if (currentMoonAgeValue > 10 && currentMoonAgeValue < 11) {
                messageArea.textContent = "十一日の月";
                target.src = "{{ url_for('static', filename='11.png') }}";
            } else if (currentMoonAgeValue > 11 && currentMoonAgeValue < 12) {
                messageArea.textContent = "十二日の月";
                target.src = "{{ url_for('static', filename='12.png') }}";
            } else if (currentMoonAgeValue > 12 && currentMoonAgeValue < 13) {
                messageArea.textContent = "十三夜";
                target.src = "{{ url_for('static', filename='13.png') }}";
            } else if (currentMoonAgeValue > 13 && currentMoonAgeValue < 14) {
                messageArea.textContent = "小望月";
                target.src = "{{ url_for('static', filename='14.png') }}";
            } else if (currentMoonAgeValue > 14 && currentMoonAgeValue < 15) {
                messageArea.textContent = "満月";
                target.src = "{{ url_for('static', filename='15.png') }}";
            } else if (currentMoonAgeValue > 15 && currentMoonAgeValue < 16) {
                messageArea.textContent = "十六夜";
                target.src = "{{ url_for('static', filename='16.png') }}";
            } else if (currentMoonAgeValue > 16 && currentMoonAgeValue < 17) {
                messageArea.textContent = "立待夜";
                target.src = "{{ url_for('static', filename='17.png') }}";
            } else if (currentMoonAgeValue > 17 && currentMoonAgeValue < 18) {
                messageArea.textContent = "居待月";
                target.src = "{{ url_for('static', filename='18.png') }}";
            } else if (currentMoonAgeValue > 18 && currentMoonAgeValue < 19) {
                messageArea.textContent = "臥待月";
                target.src = "{{ url_for('static', filename='19.png') }}";
            } else if (currentMoonAgeValue > 19 && currentMoonAgeValue < 20) {
                messageArea.textContent = "更待月";
                target.src = "{{ url_for('static', filename='20.png') }}";
            } else if (currentMoonAgeValue > 20 && currentMoonAgeValue < 21) {
                messageArea.textContent = "二十一夜";
                target.src = "{{ url_for('static', filename='21.png') }}";
            } else if (currentMoonAgeValue > 21 && currentMoonAgeValue < 22) {
                messageArea.textContent = "二十二夜";
                target.src = "{{ url_for('static', filename='22.png') }}";
            } else if (currentMoonAgeValue > 22 && currentMoonAgeValue < 23) {
                messageArea.textContent = "下弦の月";
                target.src = "{{ url_for('static', filename='23.png') }}";
            } else if (currentMoonAgeValue > 23 && currentMoonAgeValue < 24) {
                messageArea.textContent = "二十四夜";
                target.src = "{{ url_for('static', filename='24.png') }}";
            } else if (currentMoonAgeValue > 24 && currentMoonAgeValue < 25) {
                messageArea.textContent = "二十五夜";
                target.src = "{{ url_for('static', filename='25.png') }}";
            } else if (currentMoonAgeValue > 25 && currentMoonAgeValue < 26) {
                messageArea.textContent = "二十六夜";
                target.src = "{{ url_for('static', filename='26.png') }}";
            } else if (currentMoonAgeValue > 26 && currentMoonAgeValue < 27) {
                messageArea.textContent = "二十七夜";
                target.src = "{{ url_for('static', filename='27.png') }}";
            } else if (currentMoonAgeValue > 27 && currentMoonAgeValue < 28) {
                messageArea.textContent = "有明の月";
                target.src = "{{ url_for('static', filename='28.png') }}";
            } else if (currentMoonAgeValue > 28 && currentMoonAgeValue < 29) {
                messageArea.textContent = "二十九日月";
                target.src = "{{ url_for('static', filename='29.png') }}";
            } else if (currentMoonAgeValue > 29 && currentMoonAgeValue < 30) {
                messageArea.textContent = "三十日月";
                target.src = "{{ url_for('static', filename='30.png') }}";
            }

 
     
        }

        // ページ読み込み時に月齢を表示
        displayMoonAge();
    </script>
    
</div>




<div class="stsure">
  <h3>〈ヘッドライン〉本日のおすすめ</h3>
  {% if most_popular_thread %}
    <div class="sure">
      <ul id="threads"> <!-- IDをわかりやすい名前に変更 -->
        <li class="thread-item theme-{{ theme }}"> <!-- テーマクラスを追加 -->
          <div class="sumaho">
            <a href="/thread/{{most_popular_thread.id}}" class="suretai">
              <span class="thread-title">{{most_popular_thread.title}}</span> 
              <span class="thread-count">({{most_popular_thread.count}})</span>
            </a>
          </div>
        </li>
      </ul>
    </div>
  {% else %}
    <p>まだおすすめスレッドはありません。</p>
  {% endif %}
</div>

<div class="stsure">
    <div class="sure">
    <h3>スレッド一覧</h3>
        <ul id="threads">  <!-- IDを posts ではなく threads に修正 -->
            {% for id, title, created_at, count in threads %}
                <li class="thread-item theme-{{ theme }}">
<div class="sumaho">
                    <a href="/thread/{{id}}" class="suretai">
                        <span class="thread-title">{{title}}</span>
                        <span class="thread-count">({{count}})</span>
                    </a>
</div>
                </li>
            {% endfor %}
        </ul>
    </div>
</div>

<script>
// ランダムなHEXカラーコードを生成する関数
function generatePastelColor() {
  // 色相 (Hue): 0から360の間でランダムな値。これにより色の種類（赤、青、緑など）が決まる。
  const hue = Math.floor(Math.random() * 360);

  // 彩度 (Saturation): 60%から100%の間でランダムな値。鮮やかさを指定。
  // 淡い色を生成するためには彩度を完全に低くしすぎないことが重要です。
  const saturation = Math.floor(Math.random() * 40) + 60; // 60% - 100%

  // 明るさ (Lightness): 70%から90%の間でランダムな値。これが「淡さ」の鍵。
  // 100%に近づくほど白に近くなります。
  const lightness = Math.floor(Math.random() * 20) + 70; // 70% - 90%

  // CSSで使用できるhsl形式の文字列を返す
  return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
}




// すべての .color-box 要素を取得する
const colorBoxes = document.querySelectorAll('.suretai');

// 各要素にランダムな色を適用する
colorBoxes.forEach(box => {
    const color = generatePastelColor();
    box.style.backgroundColor = color;
    // ここでCSSカスタムプロパティを設定する
    box.style.setProperty('--after-color', color);
});

</script>



    <div class="suretate">
        <h2 id="1">新規スレッド作成</h2>
        <form method="post" action="/thread/new">
            スレッドタイトル<br> <input type="text" name="title"><br>
            名前<br> <input type="text" name="name"><br>
            本文<br> <textarea name="message"></textarea><br>
            画像<input type="file" id="fileInput" accept="image/*">
            <button type="submit"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQW6NQ-F5TTDCPdDXsGDAhndbaAtSTZcprBavF0TfPs76b9VdWni0Nod2sECuEgXMl9Dec&usqp=CAU" height ="20" width="20" />スレッドを立てる</button>
        </form>
    </div>
    <DIV class="suretate">
    <form method="post" action="/set_theme">
        <h3>テーマ</h3>
        <select name="theme">
            <option value="d">デフォルト</option>
            <option value="m">Midnight Tokyo</option>
        </select>
        <button type="submit">変更</button>
    </form>
    </DIV>
<script>
// 自動アップロード（fileInputを選択した瞬間に走る）
document.getElementById("fileInput").addEventListener("change", async function () {
    const file = this.files[0];
    if (!file) return;

    const formData = new FormData();
    formData.append("imageFile", file);  // ← Flask の upload が受け取るキーは imageFile

    try {
        const res = await fetch("/upload", {
            method: "POST",
            body: formData
        });

        const data = await res.json();

        if (!data.url) {
            alert("アップロードに失敗しました");
            return;
        }

        // 自動で textarea に追加
        const textarea = document.getElementById("messageArea");
        textarea.value += "\n" + data.url;

        // 表示
        const fullURL = data.url;
        document.getElementById("result").innerHTML =
            `<p>画像URL:</p>
             <a href="${fullURL}" target="_blank">${fullURL}</a><br>
             <img src="${fullURL}" style="max-width:200px;">`;

        console.log("Uploaded:", fullURL);

    } catch (err) {
        console.error(err);
        alert("通信エラーが発生しました");
    }
});
</script>

</body>
</html>
